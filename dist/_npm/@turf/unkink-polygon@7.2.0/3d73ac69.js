/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.37.0.
 * Original file: /npm/@turf/unkink-polygon@7.2.0/dist/esm/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{flattenEach as e,featureEach as n}from"../meta@7.2.0/c0f2fe64.js";import{polygon as r,featureCollection as t}from"../helpers@7.2.0/28807c9c.js";import o from"../../rbush@3.0.1/d425f52b.js";import{area as i}from"../area@7.2.0/63969d19.js";import{booleanPointInPolygon as g}from"../boolean-point-in-polygon@7.2.0/080fdfef.js";function a(e,n,r){if("Polygon"!==e.geometry.type)throw new Error("The input feature must be a Polygon");void 0===r&&(r=1);var t=e.geometry.coordinates,i=[],g={};if(r){for(var a=[],s=0;s<t.length;s++)for(var f=0;f<t[s].length-1;f++)a.push(v(s,f));var l=new o;l.load(a)}for(var u=0;u<t.length;u++)for(var c=0;c<t[u].length-1;c++){if(r)l.search(v(u,c)).forEach((function(e){var n=e.ring,r=e.edge;m(u,c,n,r)}));else for(var h=0;h<t.length;h++)for(var p=0;p<t[h].length-1;p++)m(u,c,h,p)}return n||(i={type:"Feature",geometry:{type:"MultiPoint",coordinates:i}}),i;function m(e,r,o,a){var s,f,l=t[e][r],u=t[e][r+1],c=t[o][a],h=t[o][a+1],p=function(e,n,r,t){if(d(e,r)||d(e,t)||d(n,r)||d(t,r))return null;var o=e[0],i=e[1],g=n[0],a=n[1],s=r[0],f=r[1],l=t[0],u=t[1],c=(o-g)*(f-u)-(i-a)*(s-l);return 0===c?null:[((o*a-i*g)*(s-l)-(o-g)*(s*u-f*l))/c,((o*a-i*g)*(f-u)-(i-a)*(s*u-f*l))/c]}(l,u,c,h);if(null!==p&&(s=u[0]!==l[0]?(p[0]-l[0])/(u[0]-l[0]):(p[1]-l[1])/(u[1]-l[1]),f=h[0]!==c[0]?(p[0]-c[0])/(h[0]-c[0]):(p[1]-c[1])/(h[1]-c[1]),!(s>=1||s<=0||f>=1||f<=0))){var m=p,v=!g[m];v&&(g[m]=!0),n?i.push(n(p,e,r,l,u,s,o,a,c,h,f,v)):i.push(p)}}function v(e,n){var r,o,i,g,a=t[e][n],d=t[e][n+1];return a[0]<d[0]?(r=a[0],o=d[0]):(r=d[0],o=a[0]),a[1]<d[1]?(i=a[1],g=d[1]):(i=d[1],g=a[1]),{minX:r,minY:i,maxX:o,maxY:g,ring:e,edge:n}}}function d(e,n){if(!e||!n)return!1;if(e.length!==n.length)return!1;for(var r=0,t=e.length;r<t;r++)if(e[r]instanceof Array&&n[r]instanceof Array){if(!d(e[r],n[r]))return!1}else if(e[r]!==n[r])return!1;return!0}function s(e){if("Feature"!=e.type)throw new Error("The input must a geojson object of type Feature");if(void 0===e.geometry||null==e.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=e.geometry.type)throw new Error("The input must be a geojson Polygon");for(var n=e.geometry.coordinates.length,d=[],s=0;s<n;s++){var m=e.geometry.coordinates[s];h(m[0],m[m.length-1])||m.push(m[0]);for(var v=0;v<m.length-1;v++)d.push(m[v])}if(!function(e){for(var n={},r=1,t=0,o=e.length;t<o;++t){if(Object.prototype.hasOwnProperty.call(n,e[t])){r=0;break}n[e[t]]=1}return r}(d))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var A=d.length,y=a(e,(function(e,n,r,t,o,i,g,a,d,s,f,l){return[e,n,r,t,o,i,g,a,d,s,f,l]})),E=y.length;if(0==E){var x=[];for(s=0;s<n;s++)x.push(r([e.geometry.coordinates[s]],{parent:-1,winding:c(e.geometry.coordinates[s])}));var w=t(x);return S(),U(),w}var I=[],b=[];for(s=0;s<n;s++){I.push([]);for(v=0;v<e.geometry.coordinates[s].length-1;v++)I[s].push([new f(e.geometry.coordinates[s][p(v+1,e.geometry.coordinates[s].length-1)],1,[s,v],[s,p(v+1,e.geometry.coordinates[s].length-1)],void 0)]),b.push(new l(e.geometry.coordinates[s][v],[s,p(v-1,e.geometry.coordinates[s].length-1)],[s,v],void 0,void 0,!1,!0))}for(s=0;s<E;s++)I[y[s][1]][y[s][2]].push(new f(y[s][0],y[s][5],[y[s][1],y[s][2]],[y[s][6],y[s][7]],void 0)),y[s][11]&&b.push(new l(y[s][0],[y[s][1],y[s][2]],[y[s][6],y[s][7]],void 0,void 0,!0,!0));var R=b.length;for(s=0;s<I.length;s++)for(v=0;v<I[s].length;v++)I[s][v].sort((function(e,n){return e.param<n.param?-1:1}));var k=[];for(s=0;s<R;s++)k.push({minX:b[s].coord[0],minY:b[s].coord[1],maxX:b[s].coord[0],maxY:b[s].coord[1],index:s});var W=new o;W.load(k);for(s=0;s<I.length;s++)for(v=0;v<I[s].length;v++)for(var X=0;X<I[s][v].length;X++){P=X==I[s][v].length-1?I[s][p(v+1,e.geometry.coordinates[s].length-1)][0].coord:I[s][v][X+1].coord;var Y=W.search({minX:P[0],minY:P[1],maxX:P[0],maxY:P[1]})[0];I[s][v][X].nxtIsectAlongEdgeIn=Y.index}for(s=0;s<I.length;s++)for(v=0;v<I[s].length;v++)for(X=0;X<I[s][v].length;X++){var P=I[s][v][X].coord,j=(Y=W.search({minX:P[0],minY:P[1],maxX:P[0],maxY:P[1]})[0]).index;j<A?b[j].nxtIsectAlongRingAndEdge2=I[s][v][X].nxtIsectAlongEdgeIn:h(b[j].ringAndEdge1,I[s][v][X].ringAndEdgeIn)?b[j].nxtIsectAlongRingAndEdge1=I[s][v][X].nxtIsectAlongEdgeIn:b[j].nxtIsectAlongRingAndEdge2=I[s][v][X].nxtIsectAlongEdgeIn}var T=[];for(s=0,v=0;v<n;v++){var F=s;for(X=0;X<e.geometry.coordinates[v].length-1;X++)b[s].coord[0]<b[F].coord[0]&&(F=s),s++;var O=b[F].nxtIsectAlongRingAndEdge2;for(X=0;X<b.length;X++)if(b[X].nxtIsectAlongRingAndEdge1==F||b[X].nxtIsectAlongRingAndEdge2==F){var q=X;break}var B=u([b[q].coord,b[F].coord,b[O].coord],!0)?1:-1;T.push({isect:F,parent:-1,winding:B})}T.sort((function(e,n){return b[e.isect].coord>b[n.isect].coord?-1:1}));for(x=[];T.length>0;){var M=T.pop(),z=M.isect,C=M.parent,D=M.winding,G=x.length,H=[b[z].coord],J=z;if(b[z].ringAndEdge1Walkable)var K=b[z].ringAndEdge1,L=b[z].nxtIsectAlongRingAndEdge1;else K=b[z].ringAndEdge2,L=b[z].nxtIsectAlongRingAndEdge2;for(;!h(b[z].coord,b[L].coord);){H.push(b[L].coord);var N=void 0;for(s=0;s<T.length;s++)if(T[s].isect==L){N=s;break}if(null!=N&&T.splice(N,1),h(K,b[L].ringAndEdge1)){if(K=b[L].ringAndEdge2,b[L].ringAndEdge2Walkable=!1,b[L].ringAndEdge1Walkable){var Q={isect:L};u([b[J].coord,b[L].coord,b[b[L].nxtIsectAlongRingAndEdge2].coord],1==D)?(Q.parent=C,Q.winding=-D):(Q.parent=G,Q.winding=D),T.push(Q)}J=L,L=b[L].nxtIsectAlongRingAndEdge2}else{if(K=b[L].ringAndEdge1,b[L].ringAndEdge1Walkable=!1,b[L].ringAndEdge2Walkable){Q={isect:L};u([b[J].coord,b[L].coord,b[b[L].nxtIsectAlongRingAndEdge1].coord],1==D)?(Q.parent=C,Q.winding=-D):(Q.parent=G,Q.winding=D),T.push(Q)}J=L,L=b[L].nxtIsectAlongRingAndEdge1}}H.push(b[L].coord),x.push(r([H],{index:G,parent:C,winding:D,netWinding:void 0}))}w=t(x);function S(){for(var e=[],n=0;n<w.features.length;n++)-1==w.features[n].properties.parent&&e.push(n);if(e.length>1)for(n=0;n<e.length;n++){for(var r=-1,t=1/0,o=0;o<w.features.length;o++)e[n]!=o&&g(w.features[e[n]].geometry.coordinates[0][0],w.features[o],{ignoreBoundary:!0})&&i(w.features[o])<t&&(r=o);w.features[e[n]].properties.parent=r}}function U(){for(var e=0;e<w.features.length;e++)if(-1==w.features[e].properties.parent){var n=w.features[e].properties.winding;w.features[e].properties.netWinding=n,V(e,n)}}function V(e,n){for(var r=0;r<w.features.length;r++)if(w.features[r].properties.parent==e){var t=n+w.features[r].properties.winding;w.features[r].properties.netWinding=t,V(r,t)}}return S(),U(),w}var f=function(e,n,r,t,o){this.coord=e,this.param=n,this.ringAndEdgeIn=r,this.ringAndEdgeOut=t,this.nxtIsectAlongEdgeIn=o},l=function(e,n,r,t,o,i,g){this.coord=e,this.ringAndEdge1=n,this.ringAndEdge2=r,this.nxtIsectAlongRingAndEdge1=t,this.nxtIsectAlongRingAndEdge2=o,this.ringAndEdge1Walkable=i,this.ringAndEdge2Walkable=g};function u(e,n){if(void 0===n&&(n=!0),3!=e.length)throw new Error("This function requires an array of three points [x,y]");return(e[1][0]-e[0][0])*(e[2][1]-e[0][1])-(e[1][1]-e[0][1])*(e[2][0]-e[0][0])>=0==n}function c(e){for(var n=0,r=0;r<e.length-1;r++)e[r][0]<e[n][0]&&(n=r);if(u([e[p(n-1,e.length-1)],e[n],e[p(n+1,e.length-1)]],!0))var t=1;else t=-1;return t}function h(e,n){if(!e||!n)return!1;if(e.length!=n.length)return!1;for(var r=0,t=e.length;r<t;r++)if(e[r]instanceof Array&&n[r]instanceof Array){if(!h(e[r],n[r]))return!1}else if(e[r]!=n[r])return!1;return!0}function p(e,n){return(e%n+n)%n}function m(o){var i=[];return e(o,(function(e){"Polygon"===e.geometry.type&&n(s(e),(function(n){i.push(r(n.geometry.coordinates,e.properties))}))})),t(i)}var v=m;export{v as default,m as unkinkPolygon};

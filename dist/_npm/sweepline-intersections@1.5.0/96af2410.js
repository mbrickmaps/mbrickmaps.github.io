/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sweepline-intersections@1.5.0/dist/sweeplineIntersections.esm.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
class t{constructor(t=[],n=e){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const p=t-1>>1,r=e[p];if(n(i,r)>=0)break;e[t]=r,t=p}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,p=e[t];for(;t<i;){let i=1+(t<<1),r=e[i];const s=i+1;if(s<this.length&&n(e[s],r)<0&&(i=s,r=e[s]),n(r,p)>=0)break;e[t]=r,t=i}e[t]=p}}function e(t,e){return t<e?-1:t>e?1:0}function n(t,e){return t.p.x>e.p.x?1:t.p.x<e.p.x?-1:t.p.y!==e.p.y?t.p.y>e.p.y?1:-1:1}function i(t,e){return t.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:t.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:t.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?t.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class p{constructor(t,e,n,i){this.p={x:t[0],y:t[1]},this.featureId=e,this.ringId=n,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(t){return this.p.x===t.p.x&&this.p.y===t.p.y}}let r=0,s=0,h=0;function o(t,e){const i="Feature"===t.type?t.geometry:t;let o=i.coordinates;"Polygon"!==i.type&&"MultiLineString"!==i.type||(o=[o]),"LineString"===i.type&&(o=[[o]]);for(let t=0;t<o.length;t++)for(let i=0;i<o[t].length;i++){let l=o[t][i][0],f=null;s+=1;for(let u=0;u<o[t][i].length-1;u++){f=o[t][i][u+1];const a=new p(l,r,s,h),g=new p(f,r,s,h+1);a.otherEvent=g,g.otherEvent=a,n(a,g)>0?(g.isLeftEndpoint=!0,a.isLeftEndpoint=!1):(a.isLeftEndpoint=!0,g.isLeftEndpoint=!1),e.push(a),e.push(g),l=f,h+=1}}r+=1}class l{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}}function f(t,e){if(null===t||null===e)return!1;if(t.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.rightSweepEvent)||t.leftSweepEvent.isSamePoint(e.leftSweepEvent)||t.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const n=t.leftSweepEvent.p.x,i=t.leftSweepEvent.p.y,p=t.rightSweepEvent.p.x,r=t.rightSweepEvent.p.y,s=e.leftSweepEvent.p.x,h=e.leftSweepEvent.p.y,o=e.rightSweepEvent.p.x,l=e.rightSweepEvent.p.y,f=(l-h)*(p-n)-(o-s)*(r-i),u=(o-s)*(i-h)-(l-h)*(n-s),a=(p-n)*(i-h)-(r-i)*(n-s);if(0===f)return!1;const g=u/f,E=a/f;if(g>=0&&g<=1&&E>=0&&E<=1){return[n+g*(p-n),i+g*(r-i)]}return!1}function u(e,p){const r=new t([],n);return function(t,e){if("FeatureCollection"===t.type){const n=t.features;for(let t=0;t<n.length;t++)o(n[t],e)}else o(t,e)}(e,r),function(e,n){n=n||!1;const p=[],r=new t([],i);for(;e.length;){const t=e.pop();if(t.isLeftEndpoint){const e=new l(t);for(let i=0;i<r.data.length;i++){const s=r.data[i];if(n&&s.leftSweepEvent.featureId===t.featureId)continue;const h=f(e,s);!1!==h&&p.push(h)}r.push(e)}else!1===t.isLeftEndpoint&&r.pop()}return p}(r,p)}export{u as default};

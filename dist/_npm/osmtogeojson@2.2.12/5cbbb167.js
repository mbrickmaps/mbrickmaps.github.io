/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/osmtogeojson@2.2.12/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import e from"../geojson-rewind@0.1.0/a5a63eca.js";import n from"../osm-polygon-features@0.9.2/678a45f6.js";var t,r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i={exports:{}};t=i,r=i.exports,function(){var e=[],n={},i=40,a=/\w*$/,s=/^\s*function[ \n\r\t]+\w/,l=/\bthis\b/,u=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],c="[object Arguments]",f="[object Array]",p="[object Boolean]",g="[object Date]",d="[object Error]",y="[object Function]",b="[object Number]",m="[object Object]",h="[object RegExp]",v="[object String]",w={};w[y]=!1,w[c]=w[f]=w[p]=w[g]=w[b]=w[m]=w[h]=w[v]=!0;var _={configurable:!1,enumerable:!1,value:null,writable:!1},A={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},x={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},E=x[typeof window]&&window||this,j=x.object&&r&&!r.nodeType&&r,P=x.object&&t&&!t.nodeType&&t,O=P&&P.exports===j&&j,T=x[typeof o]&&o;function N(){return e.pop()||[]}function C(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}function S(n){n.length=0,e.length<i&&e.push(n)}function B(e,n,t){n||(n=0),void 0===t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}!T||T.global!==T&&T.window!==T||(E=T);var L=[],M=Error.prototype,F=Object.prototype,I=String.prototype,D=F.toString,R=RegExp("^"+String(D).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),G=Function.prototype.toString,H=le(H=Object.getPrototypeOf)&&H,W=F.hasOwnProperty,$=L.push,X=F.propertyIsEnumerable,V=L.unshift,q=function(){try{var e={},n=le(n=Object.defineProperty)&&n,t=n(e,e,e)&&n}catch(e){}return t}(),z=le(z=Object.create)&&z,J=le(J=Array.isArray)&&J,K=le(K=Object.keys)&&K,Q={};Q[f]=Array,Q[p]=Boolean,Q[g]=Date,Q[y]=Function,Q[m]=Object,Q[b]=Number,Q[h]=RegExp,Q[v]=String;var U={};function Y(){}U[f]=U[g]=U[b]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},U[p]=U[v]={constructor:!0,toString:!0,valueOf:!0},U[d]=U[y]=U[h]={constructor:!0,toString:!0},U[m]={constructor:!0},function(){for(var e=u.length;e--;){var n=u[e];for(var t in U)W.call(U,t)&&!W.call(U[t],n)&&(U[t][n]=!1)}}();var Z=Y.support={};function ee(e){var n=e[0],t=e[2],r=e[4];function o(){if(t){var e=B(t);$.apply(e,arguments)}if(this instanceof o){var i=te(n.prototype),a=n.apply(i,e||arguments);return xe(a)?a:i}return n.apply(r,e||arguments)}return ue(o,e),o}function ne(e,n,t,r,o){if(t){var i=t(e);if(void 0!==i)return i}if(!xe(e))return e;var s=D.call(e);if(!w[s]||!Z.nodeClass&&C(e))return e;var l=Q[s];switch(s){case p:case g:return new l(+e);case b:case v:return new l(e);case h:return(i=l(e.source,a.exec(e))).lastIndex=e.lastIndex,i}var u=pe(e);if(n){var c=!r;r||(r=N()),o||(o=N());for(var f=r.length;f--;)if(r[f]==e)return o[f];i=u?l(e.length):{}}else i=u?B(e):ve({},e);return u&&(W.call(e,"index")&&(i.index=e.index),W.call(e,"input")&&(i.input=e.input)),n?(r.push(e),o.push(i),(u?he:_e)(e,(function(e,a){i[a]=ne(e,n,t,r,o)})),c&&(S(r),S(o)),i):i}function te(e,n){return xe(e)?z(e):{}}function re(e,n,t){if("function"!=typeof e)return Oe;if(void 0===n||!("prototype"in e))return e;var r=e.__bindData__;if(void 0===r&&(Z.funcNames&&(r=!e.name),!(r=r||!Z.funcDecomp))){var o=G.call(e);Z.funcNames||(r=!s.test(o)),r||(r=l.test(o),ue(e,r))}if(!1===r||!0!==r&&1&r[1])return e;switch(t){case 1:return function(t){return e.call(n,t)};case 2:return function(t,r){return e.call(n,t,r)};case 3:return function(t,r,o){return e.call(n,t,r,o)};case 4:return function(t,r,o,i){return e.call(n,t,r,o,i)}}return Pe(e,n)}function oe(e){var n=e[0],t=e[1],r=e[2],o=e[3],i=e[4],a=e[5],s=1&t,l=2&t,u=4&t,c=8&t,f=n;function p(){var e=s?i:this;if(r){var g=B(r);$.apply(g,arguments)}if((o||u)&&(g||(g=B(arguments)),o&&$.apply(g,o),u&&g.length<a))return t|=16,oe([n,c?t:-4&t,g,null,i,a]);if(g||(g=arguments),l&&(n=e[f]),this instanceof p){e=te(n.prototype);var d=n.apply(e,g);return xe(d)?d:e}return n.apply(e,g)}return ue(p,e),p}function ie(e,n,t,r,o){(pe(n)?ke:_e)(n,(function(n,i){var a,s,l=n,u=e[i];if(n&&((s=pe(n))||Ee(n))){for(var c,f=r.length;f--;)if(a=r[f]==n){u=o[f];break}a||(t&&(c=void 0!==(l=t(u,n)))&&(u=l),c||(u=s?pe(u)?u:[]:Ee(u)?u:{}),r.push(n),o.push(u),c||ie(u,n,t,r,o))}else t&&void 0===(l=t(u,n))&&(l=n),void 0!==l&&(u=l);e[i]=u}))}function ae(e,n,t,r,o,i){var a=1&n,s=4&n,l=16&n,u=32&n;if(!(2&n||Ae(e)))throw new TypeError;l&&!t.length&&(n&=-17,l=t=!1),u&&!r.length&&(n&=-33,u=r=!1);var c=e&&e.__bindData__;return c&&!0!==c?((c=B(c))[2]&&(c[2]=B(c[2])),c[3]&&(c[3]=B(c[3])),!a||1&c[1]||(c[4]=o),!a&&1&c[1]&&(n|=8),!s||4&c[1]||(c[5]=i),l&&$.apply(c[2]||(c[2]=[]),t),u&&V.apply(c[3]||(c[3]=[]),r),c[1]|=n,ae.apply(null,c)):(1==n||17===n?ee:oe)([e,n,t,r,o,i])}function se(){A.shadowedProps=u,A.array=A.bottom=A.loop=A.top="",A.init="iterable",A.useHas=!0;for(var e,t=0;e=arguments[t];t++)for(var r in e)A[r]=e[r];var o=A.args;return A.firstArg=/^[^,]+/.exec(o)[0],Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+o+") {\n"+function(e){var n="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";";e.array?(n+="\nvar length = iterable.length; index = -1;\nif ("+e.array+") {  ",Z.unindexedChars&&(n+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),n+="\n  while (++index < length) {\n    "+e.loop+";\n  }\n}\nelse {  "):Z.nonEnumArgs&&(n+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+e.loop+";\n    }\n  } else {  "),Z.enumPrototypes&&(n+="\n  var skipProto = typeof iterable == 'function';\n  "),Z.enumErrorProps&&(n+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var t=[];if(Z.enumPrototypes&&t.push('!(skipProto && index == "prototype")'),Z.enumErrorProps&&t.push('!(skipErrorProps && (index == "message" || index == "name"))'),e.useHas&&e.keys)n+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",t.length&&(n+="    if ("+t.join(" && ")+") {\n  "),n+=e.loop+";    ",t.length&&(n+="\n    }"),n+="\n  }  ";else if(n+="\n  for (index in iterable) {\n",e.useHas&&t.push("hasOwnProperty.call(iterable, index)"),t.length&&(n+="    if ("+t.join(" && ")+") {\n  "),n+=e.loop+";    ",t.length&&(n+="\n    }"),n+="\n  }    ",Z.nonEnumShadows){for(n+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;k<7;k++)n+="\n    index = '"+e.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",e.useHas||(n+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),n+=") {\n      "+e.loop+";\n    }      ";n+="\n  }    "}return(e.array||Z.nonEnumArgs)&&(n+="\n}"),n+(e.bottom+";\nreturn result")}(A)+"\n}")(re,d,M,W,n,fe,pe,je,A.keys,F,x,U,v,I,D)}function le(e){return"function"==typeof e&&R.test(e)}!function(){var e=function(){this.x=1},n={0:1,length:1},t=[];for(var r in e.prototype={valueOf:1,y:1},new e)t.push(r);for(r in arguments);Z.argsClass=D.call(arguments)==c,Z.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),Z.enumErrorProps=X.call(M,"message")||X.call(M,"name"),Z.enumPrototypes=X.call(e,"prototype"),Z.funcDecomp=!le(E.WinRTError)&&l.test((function(){return this})),Z.funcNames="string"==typeof Function.name,Z.nonEnumArgs=0!=r,Z.nonEnumShadows=!/valueOf/.test(t),Z.ownLast="x"!=t[0],Z.spliceObjects=(L.splice.call(n,0,1),!n[0]),Z.unindexedChars="x"[0]+Object("x")[0]!="xx";try{Z.nodeClass=!(D.call(document)==m&&!({toString:0}+""))}catch(e){Z.nodeClass=!0}}(1),z||(te=function(){function e(){}return function(n){if(xe(n)){e.prototype=n;var t=new e;e.prototype=null}return t||E.Object()}}());var ue=q?function(e,n){_.value=n,q(e,"__bindData__",_)}:Te;function ce(e){var n,t;return!(!e||D.call(e)!=m||Ae(n=e.constructor)&&!(n instanceof n)||!Z.argsClass&&fe(e)||!Z.nodeClass&&C(e))&&(Z.ownLast?(we(e,(function(e,n,r){return t=W.call(r,n),!1})),!1!==t):(we(e,(function(e,n){t=n})),void 0===t||W.call(e,t)))}function fe(e){return e&&"object"==typeof e&&"number"==typeof e.length&&D.call(e)==c||!1}Z.argsClass||(fe=function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&W.call(e,"callee")&&!X.call(e,"callee")||!1});var pe=J||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&D.call(e)==f||!1},ge=se({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),de=K?function(e){return xe(e)?Z.enumPrototypes&&"function"==typeof e||Z.nonEnumArgs&&e.length&&fe(e)?ge(e):K(e):[]}:ge,ye={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:de,loop:"if (callback(iterable[index], index, collection) === false) return result"},be={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:de,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},me={top:"if (!objectTypes[typeof iterable]) return result;\n"+ye.top,array:!1},he=se(ye),ve=se(be,{top:be.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),we=se(ye,me,{useHas:!1}),_e=se(ye,me);function Ae(e){return"function"==typeof e}function xe(e){return!(!e||!x[typeof e])}Ae(/x/)&&(Ae=function(e){return"function"==typeof e&&D.call(e)==y});var Ee=H?function(e){if(!e||D.call(e)!=m||!Z.argsClass&&fe(e))return!1;var n=e.valueOf,t=le(n)&&(t=H(n))&&H(t);return t?e==t||H(e)==t:ce(e)}:ce;function je(e){return"string"==typeof e||e&&"object"==typeof e&&D.call(e)==v||!1}function ke(e,n,t){if(n&&void 0===t&&pe(e))for(var r=-1,o=e.length;++r<o&&!1!==n(e[r],r,e););else he(e,n,t);return e}function Pe(e,n){return arguments.length>2?ae(e,17,B(arguments,2),null,n):ae(e,1,null,null,n)}function Oe(e){return e}function Te(){}Y.assign=ve,Y.bind=Pe,Y.compact=function(e){for(var n=-1,t=e?e.length:0,r=[];++n<t;){var o=e[n];o&&r.push(o)}return r},Y.forEach=ke,Y.forIn=we,Y.forOwn=_e,Y.keys=de,Y.merge=function(e){var n=arguments,t=2;if(!xe(e))return e;if("number"!=typeof n[2]&&(t=n.length),t>3&&"function"==typeof n[t-2])var r=re(n[--t-1],n[t--],2);else t>2&&"function"==typeof n[t-1]&&(r=n[--t]);for(var o=B(arguments,1,t),i=-1,a=N(),s=N();++i<t;)ie(e,o[i],r,a,s);return S(a),S(s),e},Y.each=ke,Y.extend=ve,Y.clone=function(e,n,t,r){return"boolean"!=typeof n&&null!=n&&(r=t,t=n,n=!1),ne(e,n,"function"==typeof t&&re(t,r,1))},Y.identity=Oe,Y.isArguments=fe,Y.isArray=pe,Y.isEmpty=function(e){var n=!0;if(!e)return n;var t=D.call(e),r=e.length;return t==f||t==v||(Z.argsClass?t==c:fe(e))||t==m&&"number"==typeof r&&Ae(e.splice)?!r:(_e(e,(function(){return n=!1})),n)},Y.isFunction=Ae,Y.isObject=xe,Y.isPlainObject=Ee,Y.isString=je,Y.noop=Te,Y.VERSION="2.4.1",j&&P&&O&&((P.exports=Y)._=Y)}.call(o);var a=i.exports,s=e,l={};n.forEach((function(e){if("all"===e.polygon)l[e.key]=!0;else{var n="whitelist"===e.polygon?"included_values":"excluded_values",t={};e.values.forEach((function(e){t[e]=!0})),l[e.key]={},l[e.key][n]=t}}));var u;u=function(e,n){return n=a.merge({verbose:!1,flatProperties:!1,uninterestingTags:{source:!0,source_ref:!0,"source:ref":!0,history:!0,attribution:!0,created_by:!0,"tiger:county":!0,"tiger:tlid":!0,"tiger:upload_uuid":!0},polygonFeatures:l},n),"undefined"!=typeof XMLDocument&&e instanceof XMLDocument||"undefined"==typeof XMLDocument&&e.childNodes?function(e){var n,r,o=new Array,i=new Array,s=new Array;function l(e,n,t){e.hasAttribute(t)&&(n[t]=e.getAttribute(t))}function u(e,n){var t=a.clone(e);l(n,t,"lat"),l(n,t,"lon"),t.__is_center_placeholder=!0,o.push(t)}function c(e,n){var t=a.clone(e);function r(e,n,r){var i={type:"node",id:"_"+t.type+"/"+t.id+"bounds"+r,lat:e,lon:n};t.nodes.push(i.id),o.push(i)}t.nodes=[],r(n.getAttribute("minlat"),n.getAttribute("minlon"),1),r(n.getAttribute("maxlat"),n.getAttribute("minlon"),2),r(n.getAttribute("maxlat"),n.getAttribute("maxlon"),3),r(n.getAttribute("minlat"),n.getAttribute("maxlon"),4),t.nodes.push(t.nodes[0]),t.__is_bounds_placeholder=!0,i.push(t)}return a.each(e.getElementsByTagName("node"),(function(e,n){var t={};a.each(e.getElementsByTagName("tag"),(function(e){t[e.getAttribute("k")]=e.getAttribute("v")}));var r={type:"node"};l(e,r,"id"),l(e,r,"lat"),l(e,r,"lon"),l(e,r,"version"),l(e,r,"timestamp"),l(e,r,"changeset"),l(e,r,"uid"),l(e,r,"user"),a.isEmpty(t)||(r.tags=t),o.push(r)})),a.each(e.getElementsByTagName("way"),(function(e,t){var s={},f=[];a.each(e.getElementsByTagName("tag"),(function(e){s[e.getAttribute("k")]=e.getAttribute("v")}));var p=!1;a.each(e.getElementsByTagName("nd"),(function(e,n){var t;(t=e.getAttribute("ref"))&&(f[n]=t),!p&&e.getAttribute("lat")&&(p=!0)}));var g={type:"way"};l(e,g,"id"),l(e,g,"version"),l(e,g,"timestamp"),l(e,g,"changeset"),l(e,g,"uid"),l(e,g,"user"),f.length>0&&(g.nodes=f),a.isEmpty(s)||(g.tags=s),(n=e.getElementsByTagName("center")[0])&&u(g,n),p?function(e,n){function t(e,n,t){var r={type:"node",id:t,lat:e,lon:n,__is_uninteresting:!0};return o.push(r),r.id}a.isArray(e.nodes)||(e.nodes=[],a.each(n,(function(n,t){e.nodes.push("_anonymous@"+n.getAttribute("lat")+"/"+n.getAttribute("lon"))})));a.each(n,(function(n,r){n.getAttribute("lat")&&t(n.getAttribute("lat"),n.getAttribute("lon"),e.nodes[r])}))}(g,e.getElementsByTagName("nd")):(r=e.getElementsByTagName("bounds")[0])&&c(g,r),i.push(g)})),a.each(e.getElementsByTagName("relation"),(function(e,t){var f={},p=[];a.each(e.getElementsByTagName("tag"),(function(e){f[e.getAttribute("k")]=e.getAttribute("v")}));var g=!1;a.each(e.getElementsByTagName("member"),(function(e,n){p[n]={},l(e,p[n],"ref"),l(e,p[n],"role"),l(e,p[n],"type"),(!g&&"node"==p[n].type&&e.getAttribute("lat")||"way"==p[n].type&&e.getElementsByTagName("nd").length>0)&&(g=!0)}));var d={type:"relation"};l(e,d,"id"),l(e,d,"version"),l(e,d,"timestamp"),l(e,d,"changeset"),l(e,d,"uid"),l(e,d,"user"),p.length>0&&(d.members=p),a.isEmpty(f)||(d.tags=f),(n=e.getElementsByTagName("center")[0])&&u(d,n),g?function(e,n){function t(e,n,t){var r={type:"node",id:t,lat:e,lon:n};o.push(r)}function r(e,n){if(!i.some((function(e){return"way"==e.type&&e.id==n}))){var t={type:"way",id:n,nodes:[]};a.each(e,(function(e){e.getAttribute("lat")?r(e.getAttribute("lat"),e.getAttribute("lon")):t.nodes.push(void 0)})),i.push(t)}function r(e,n){var r={type:"node",id:"_anonymous@"+e+"/"+n,lat:e,lon:n,__is_uninteresting:!0};t.nodes.push(r.id),o.push(r)}}a.each(n,(function(n,o){"node"==e.members[o].type?n.getAttribute("lat")&&t(n.getAttribute("lat"),n.getAttribute("lon"),e.members[o].ref):"way"==e.members[o].type&&n.getElementsByTagName("nd").length>0&&(e.members[o].ref="_fullGeom"+e.members[o].ref,r(n.getElementsByTagName("nd"),e.members[o].ref))}))}(d,e.getElementsByTagName("member")):(r=e.getElementsByTagName("bounds")[0])&&c(d,r),s.push(d)})),t(o,i,s)}(e):function(e){var n=new Array,r=new Array,o=new Array;function i(e){var t=a.clone(e);t.lat=e.center.lat,t.lon=e.center.lon,t.__is_center_placeholder=!0,n.push(t)}function s(e){var t=a.clone(e);function o(e,r,o){var i={type:"node",id:"_"+t.type+"/"+t.id+"bounds"+o,lat:e,lon:r};t.nodes.push(i.id),n.push(i)}t.nodes=[],o(t.bounds.minlat,t.bounds.minlon,1),o(t.bounds.maxlat,t.bounds.minlon,2),o(t.bounds.maxlat,t.bounds.maxlon,3),o(t.bounds.minlat,t.bounds.maxlon,4),t.nodes.push(t.nodes[0]),t.__is_bounds_placeholder=!0,r.push(t)}function l(e){a.isArray(e.nodes)||(e.nodes=e.geometry.map((function(e){return null!==e?"_anonymous@"+e.lat+"/"+e.lon:"_anonymous@unknown_location"}))),e.geometry.forEach((function(t,r){var o,i,a,s;t&&(o=t.lat,i=t.lon,a=e.nodes[r],s={type:"node",id:a,lat:o,lon:i,__is_uninteresting:!0},n.push(s))}))}function u(e){function t(e,t){if(!r.some((function(e){return"way"==e.type&&e.id==t}))){var o={type:"way",id:t,nodes:[]};e.forEach((function(e){var t,r,i;e?(t=e.lat,r=e.lon,i={type:"node",id:"_anonymous@"+t+"/"+r,lat:t,lon:r,__is_uninteresting:!0},o.nodes.push(i.id),n.push(i)):o.nodes.push(void 0)})),r.push(o)}}e.members.forEach((function(e,r){var o,i,a,s;"node"==e.type?e.lat&&(o=e.lat,i=e.lon,a=e.ref,s={type:"node",id:a,lat:o,lon:i},n.push(s)):"way"==e.type&&e.geometry&&(e.ref="_fullGeom"+e.ref,t(e.geometry,e.ref))}))}for(var c=0;c<e.elements.length;c++)switch(e.elements[c].type){case"node":var f=e.elements[c];n.push(f);break;case"way":var p=a.clone(e.elements[c]);p.nodes=a.clone(p.nodes),r.push(p),p.center&&i(p),p.geometry?l(p):p.bounds&&s(p);break;case"relation":var g=a.clone(e.elements[c]);g.members=a.clone(g.members),o.push(g);var d=g.members&&g.members.some((function(e){return"node"==e.type&&e.lat||"way"==e.type&&e.geometry&&e.geometry.length>0}));g.center&&i(g),d?u(g):g.bounds&&s(g)}return t(n,r,o)}(e);function t(e,t,o){function i(e,t){if("object"!=typeof t&&(t={}),"function"==typeof n.uninterestingTags)return!n.uninterestingTags(e,t);for(var r in e)if(!0!==n.uninterestingTags[r]&&!0!==t[r]&&t[r]!==e[r])return!0;return!1}function l(e){var n={timestamp:e.timestamp,version:e.version,changeset:e.changeset,user:e.user,uid:e.uid};for(var t in n)void 0===n[t]&&delete n[t];return n}for(var u=new Object,c=0;c<e.length;c++)void 0!==e[c].lat?u[e[c].id]=e[c]:n.verbose&&console.warn("Node",e[c].type+"/"+e[c].id,"ignored because it has no coordinates");var f=new Object;for(c=0;c<e.length;c++)void 0!==e[c].tags&&i(e[c].tags)&&(f[e[c].id]=!0);for(c=0;c<o.length;c++)if(a.isArray(o[c].members))for(var p=0;p<o[c].members.length;p++)"node"==o[c].members[p].type&&(f[o[c].members[p].ref]=!0);else n.verbose&&console.warn("Relation",o[c].type+"/"+o[c].id,"ignored because it has no members");var g=new Object,d=new Object;for(c=0;c<t.length;c++)if(a.isArray(t[c].nodes)){g[t[c].id]=t[c];for(p=0;p<t[c].nodes.length;p++)d[t[c].nodes[p]]=!0,t[c].nodes[p]=u[t[c].nodes[p]]}else n.verbose&&console.warn("Way",t[c].type+"/"+t[c].id,"ignored because it has no nodes");var y=new Array;for(c=0;c<e.length;c++)d[e[c].id]&&!f[e[c].id]||e[c].__is_uninteresting||y.push(e[c]);var b=new Array;for(c=0;c<o.length;c++)a.isArray(o[c].members)?b[o[c].id]=o[c]:n.verbose&&console.warn("Relation",o[c].type+"/"+o[c].id,"ignored because it has no members");var m,h={node:{},way:{},relation:{}};for(c=0;c<o.length;c++)if(a.isArray(o[c].members))for(p=0;p<o[c].members.length;p++){var v=o[c].members[p].type,w=o[c].members[p].ref;"number"!=typeof w&&(w=w.replace("_fullGeom","")),h[v]?(void 0===h[v][w]&&(h[v][w]=[]),h[v][w].push({role:o[c].members[p].role,rel:o[c].id,reltags:o[c].tags})):n.verbose&&console.warn("Relation",o[c].type+"/"+o[c].id,"member",v+"/"+w,"ignored because it has an invalid type")}else n.verbose&&console.warn("Relation",o[c].type+"/"+o[c].id,"ignored because it has no members");var _={type:"FeatureCollection",features:new Array};for(c=0;c<y.length;c++)if(void 0!==y[c].lon&&void 0!==y[c].lat){var A={type:"Feature",id:y[c].type+"/"+y[c].id,properties:{type:y[c].type,id:y[c].id,tags:y[c].tags||{},relations:h.node[y[c].id]||[],meta:l(y[c])},geometry:{type:"Point",coordinates:[+y[c].lon,+y[c].lat]}};y[c].__is_center_placeholder&&(A.properties.geometry="center"),_.features.push(A)}else n.verbose&&console.warn("POI",y[c].type+"/"+y[c].id,"ignored because it lacks coordinates");var x={type:"FeatureCollection",features:new Array},E={type:"FeatureCollection",features:new Array};for(c=0;c<o.length;c++)if(void 0!==o[c].tags&&("multipolygon"==o[c].tags.type||"boundary"==o[c].tags.type)){if(!a.isArray(o[c].members)){n.verbose&&console.warn("Multipolygon",o[c].type+"/"+o[c].id,"ignored because it has no members");continue}var j=0;for(p=0;p<o[c].members.length;p++)"outer"==o[c].members[p].role?j++:n.verbose&&"inner"!=o[c].members[p].role&&console.warn("Multipolygon",o[c].type+"/"+o[c].id,"member",o[c].members[p].type+"/"+o[c].members[p].ref,'ignored because it has an invalid role: "'+o[c].members[p].role+'"');if(o[c].members.forEach((function(e){g[e.ref]&&("outer"!==e.role||i(g[e.ref].tags,o[c].tags)||(g[e.ref].is_multipolygon_outline=!0),"inner"!==e.role||i(g[e.ref].tags)||(g[e.ref].is_multipolygon_outline=!0))})),0==j){n.verbose&&console.warn("Multipolygon relation",o[c].type+"/"+o[c].id,"ignored because it has no outer ways");continue}var k=!1;1!=j||i(o[c].tags,{type:!0})||(k=!0);A=null;if(k){var P=o[c].members.filter((function(e){return"outer"===e.role}))[0];if(void 0===(P=g[P.ref])){n.verbose&&console.warn("Multipolygon relation",o[c].type+"/"+o[c].id,"ignored because outer way",P.type+"/"+P.ref,"is missing");continue}P.is_multipolygon_outline=!0,A=O(P,o[c])}else A=O(o[c],o[c]);if(!1===A){n.verbose&&console.warn("Multipolygon relation",o[c].type+"/"+o[c].id,"ignored because it has invalid geometry");continue}function O(e,t){var r,o,i,s,u=!1,c=k?"way":"relation",f="number"==typeof e.id?e.id:+e.id.replace("_fullGeom","");function p(e){for(var t,r,o,i,a,s,l=function(e){return e[0]},u=function(e){return e[e.length-1]},p=[];e.length;)for(t=e.pop().nodes.slice(),p.push(t);e.length&&l(t)!==u(t);){for(r=l(t),o=u(t),i=0;i<e.length;i++){if(o===l(s=e[i].nodes)){a=t.push,s=s.slice(1);break}if(o===u(s)){a=t.push,s=s.slice(0,-1).reverse();break}if(r==u(s)){a=t.unshift,s=s.slice(0,-1);break}if(r==l(s)){a=t.unshift,s=s.slice(1).reverse();break}s=a=null}if(!s){n.verbose&&console.warn("Multipolygon",c+"/"+f,"contains unclosed ring geometry");break}e.splice(i,1),a.apply(t,s)}return p}function d(e){var n,t=function(e,n){for(var t=0;t<n.length;t++)if(i(n[t],e))return!0;return!1},r=function(e){return e.map((function(e){return[+e.lat,+e.lon]}))},i=function(e,n){for(var t=e[0],r=e[1],o=!1,i=0,a=n.length-1;i<n.length;a=i++){var s=n[i][0],l=n[i][1],u=n[a][0],c=n[a][1];l>r!=c>r&&t<(u-s)*(r-l)/(c-l)+s&&(o=!o)}return o};for(e=r(e),n=0;n<o.length;n++)if(t(r(o[n]),e))return n}r=(r=t.members.filter((function(e){return"way"===e.type}))).map((function(e){var t=g[e.ref];return void 0===t?(n.verbose&&console.warn("Multipolygon",c+"/"+f,"tainted by a missing way",e.type+"/"+e.ref),void(u=!0)):{id:e.ref,role:e.role||"outer",way:t,nodes:t.nodes.filter((function(t){return void 0!==t||(u=!0,n.verbose&&console.warn("Multipolygon",c+"/"+f,"tainted by a way",e.type+"/"+e.ref,"with a missing node"),!1)}))}})),r=a.compact(r),o=p(r.filter((function(e){return"outer"===e.role}))),i=p(r.filter((function(e){return"inner"===e.role}))),s=o.map((function(e){return[e]}));for(var y=0;y<i.length;y++){var b=d(i[y]);void 0!==b?s[b].push(i[y]):n.verbose&&console.warn("Multipolygon",c+"/"+f,"contains an inner ring with no containing outer")}var m=[];if(0==(m=a.compact(s.map((function(e){var t=a.compact(e.map((function(e){if(!(e.length<4))return a.compact(e.map((function(e){return[+e.lon,+e.lat]})));n.verbose&&console.warn("Multipolygon",c+"/"+f,"contains a ring with less than four nodes")})));if(0!=t.length)return t;n.verbose&&console.warn("Multipolygon",c+"/"+f,"contains an empty ring cluster")})))).length)return n.verbose&&console.warn("Multipolygon",c+"/"+f,"contains no coordinates"),!1;var v="MultiPolygon";1===m.length&&(v="Polygon",m=m[0]);var w={type:"Feature",id:e.type+"/"+f,properties:{type:e.type,id:f,tags:e.tags||{},relations:h[e.type][e.id]||[],meta:l(e)},geometry:{type:v,coordinates:m}};return u&&(n.verbose&&console.warn("Multipolygon",c+"/"+f,"is tainted"),w.properties.tainted=!0),w}E.features.push(A)}for(c=0;c<t.length;c++)if(a.isArray(t[c].nodes)){if(!t[c].is_multipolygon_outline){"number"!=typeof t[c].id&&(t[c].id=+t[c].id.replace("_fullGeom","")),t[c].tainted=!1,t[c].hidden=!1;var T=new Array;for(p=0;p<t[c].nodes.length;p++)"object"==typeof t[c].nodes[p]?T.push([+t[c].nodes[p].lon,+t[c].nodes[p].lat]):(n.verbose&&console.warn("Way",t[c].type+"/"+t[c].id,"is tainted by an invalid node"),t[c].tainted=!0);if(T.length<=1)n.verbose&&console.warn("Way",t[c].type+"/"+t[c].id,"ignored because it contains too few nodes");else{var N="LineString";void 0!==t[c].nodes[0]&&t[c].nodes[0]===t[c].nodes[t[c].nodes.length-1]&&(void 0!==t[c].tags&&r(t[c].tags)||t[c].__is_bounds_placeholder)&&(N="Polygon",T=[T]);A={type:"Feature",id:t[c].type+"/"+t[c].id,properties:{type:t[c].type,id:t[c].id,tags:t[c].tags||{},relations:h.way[t[c].id]||[],meta:l(t[c])},geometry:{type:N,coordinates:T}};t[c].tainted&&(n.verbose&&console.warn("Way",t[c].type+"/"+t[c].id,"is tainted"),A.properties.tainted=!0),t[c].__is_bounds_placeholder&&(A.properties.geometry="bounds"),"LineString"==N?x.features.push(A):E.features.push(A)}}}else n.verbose&&console.warn("Way",t[c].type+"/"+t[c].id,"ignored because it has no nodes");return(m={type:"FeatureCollection",features:[]}).features=m.features.concat(E.features),m.features=m.features.concat(x.features),m.features=m.features.concat(_.features),n.flatProperties&&m.features.forEach((function(e){e.properties=a.merge(e.properties.meta,e.properties.tags,{id:e.properties.type+"/"+e.properties.id})})),m=s(m,!0)}function r(e){var t=n.polygonFeatures;if("function"==typeof t)return t(e);if("no"===e.area)return!1;for(var r in e){var o=e[r],i=t[r];if(void 0!==i&&"no"!==o){if(!0===i)return!0;if(i.included_values&&!0===i.included_values[o])return!0;if(i.excluded_values&&!0!==i.excluded_values[o])return!0}}return!1}},u.toGeojson=u;var c=u,f=c.toGeojson;export{c as default,f as toGeojson};
